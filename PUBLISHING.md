# Publishing Guide for Laravel-Next

## Package Structure

Laravel-Next is set up as a proper npm package that can be published and consumed by other projects.

```
orchestr/
├── src/                  # TypeScript source code
├── dist/                 # Compiled JavaScript (generated by build)
├── examples/            # Example applications
├── package.json         # Package configuration
├── tsconfig.json        # TypeScript configuration
├── .npmignore           # Files to exclude from npm package
└── README.md            # Documentation
```

## Pre-Publishing Checklist

1. **Update Version** in `package.json`:
   ```json
   {
     "version": "0.1.0"  // Increment according to semver
   }
   ```

2. **Build the Package**:
   ```bash
   npm run build
   ```
   This compiles TypeScript to the `dist/` directory.

3. **Test Locally** using npm link:
   ```bash
   # In orchestr directory
   npm link

   # In your test project
   npm link orchestr
   ```

4. **Verify Package Contents**:
   ```bash
   npm pack --dry-run
   ```
   This shows what will be included in the published package.

## Publishing to npm

### First-Time Setup

1. **Create npm account** at https://www.npmjs.com/signup

2. **Login to npm**:
   ```bash
   npm login
   ```

3. **Update package.json** with your details:
   ```json
   {
     "author": "Your Name <your.email@example.com>",
     "repository": {
       "type": "git",
       "url": "https://github.com/yourusername/orchestr.git"
     }
   }
   ```

### Publishing

```bash
# Build first
npm run build

# Publish to npm
npm publish
```

The `prepublishOnly` script will automatically run `npm run build` before publishing.

### Publishing Scoped Package (Recommended for organizations)

If you want to publish under a scope (e.g., `@yourorg/orchestr`):

1. Update `package.json`:
   ```json
   {
     "name": "@yourorg/orchestr"
   }
   ```

2. Publish:
   ```bash
   npm publish --access public
   ```

## Using the Published Package

Once published, users can install it:

```bash
npm install orchestr
# or
npm install @yourorg/orchestr
```

Then use it in their project:

```typescript
import { Application, Kernel, Route, RouteServiceProvider } from 'orchestr';
import 'reflect-metadata';

const app = new Application(__dirname);
app.register(RouteServiceProvider);
app.boot();

const kernel = new Kernel(app);

Route.get('/', async (req, res) => {
  res.json({ message: 'Hello World!' });
});

kernel.listen(3000);
```

## Local Development Workflow

### For Framework Development

```bash
# Make changes to src/
npm run build           # Compile TypeScript
npm link               # Link for testing
```

### For Testing in Another Project

```bash
cd ../your-test-app
npm link orchestr
npm run dev
```

### Unlinking

```bash
# In your test app
npm unlink orchestr

# In orchestr directory
npm unlink
```

## Version Management

Follow Semantic Versioning (semver):

- **MAJOR** (1.0.0): Breaking changes
- **MINOR** (0.1.0): New features, backwards compatible
- **PATCH** (0.0.1): Bug fixes

Update version:
```bash
npm version patch   # 0.1.0 -> 0.1.1
npm version minor   # 0.1.0 -> 0.2.0
npm version major   # 0.1.0 -> 1.0.0
```

## Package Distribution

The published package includes:
- `dist/` - Compiled JavaScript and type definitions
- `README.md` - Documentation
- `LICENSE` - License file
- `package.json` - Package metadata

Excluded from package (via `.npmignore`):
- `src/` - Source TypeScript files
- `examples/` - Example applications
- `tsconfig.json` - TypeScript config
- Development files and directories

## Publishing Checklist

- [ ] Update version number
- [ ] Update CHANGELOG.md (if you have one)
- [ ] Run `npm run build`
- [ ] Test locally with `npm link`
- [ ] Run tests (when you have them)
- [ ] Commit all changes
- [ ] Create git tag: `git tag v0.1.0`
- [ ] Push to GitHub: `git push && git push --tags`
- [ ] Publish: `npm publish`

## GitHub Package Registry (Alternative)

You can also publish to GitHub Packages:

1. Create `.npmrc` in project root:
   ```
   @yourusername:registry=https://npm.pkg.github.com
   ```

2. Update `package.json`:
   ```json
   {
     "name": "@yourusername/orchestr",
     "publishConfig": {
       "registry": "https://npm.pkg.github.com"
     }
   }
   ```

3. Authenticate:
   ```bash
   npm login --registry=https://npm.pkg.github.com
   ```

4. Publish:
   ```bash
   npm publish
   ```

## Troubleshooting

### "Package already exists"
- The package name is taken on npm
- Change the name in package.json or use a scoped package

### "You must be logged in"
- Run `npm login` first
- Verify with `npm whoami`

### "Permission denied"
- You don't have permission to publish this package name
- Use a different name or request access

### Types not working
- Ensure `"types": "dist/index.d.ts"` is in package.json
- Verify `.d.ts` files are generated in dist/
- Check tsconfig.json has `"declaration": true`
